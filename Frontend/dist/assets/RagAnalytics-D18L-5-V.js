import{e as y,u as D,a as S,r as a,j as e,A as C,L,D as m,g as Q}from"./index-CGocrW-2.js";import{s as h}from"./supabaseClient-XQ6Slhkl.js";import{D as A}from"./DashboardHeader-B5PeDfLb.js";import{D as k,F as q}from"./file-text-CyjinGct.js";import{C as F}from"./circle-alert-OdMR_p__.js";import{L as E}from"./layers-Bbb5VIqM.js";import{U as I}from"./users-D5Ca1YqY.js";import{C as R}from"./chart-no-axes-column-increasing-Bfv4dTGp.js";import"./index-DAE5hqnr.js";import"./x-CKoSI4A3.js";const K=()=>{const{classId:i}=y(),{currentUser:T}=D(),u=S(),[r,g]=a.useState([]),[p,n]=a.useState(!0),[o,c]=a.useState(null),[d,f]=a.useState(""),[j,b]=a.useState({id:i,name:"Loading class details..."});a.useEffect(()=>{N(),w()},[i]);const N=async()=>{try{const{data:s,error:t}=await h.from("classes").select("*").eq("id",i).single();if(t)throw t;b(s)}catch(s){console.error("Failed to fetch class details:",s),c("Failed to load class details. Please try again.")}},w=async()=>{try{n(!0);const{data:s,error:t}=await h.from("queries").select("*").eq("class_id",i).order("timestamp",{ascending:!1});if(t)throw t;g(s)}catch(s){console.error("Failed to fetch queries:",s),c("Failed to load query analytics. Please try again.")}finally{n(!1)}},x=[...d?r.filter(s=>s.question.toLowerCase().includes(d.toLowerCase())||s.userId.toLowerCase().includes(d.toLowerCase())):r].sort((s,t)=>new Date(t.timestamp)-new Date(s.timestamp)),v=()=>{const s={};return r.forEach(t=>{const l=new Date(t.timestamp).toLocaleDateString("en-US",{weekday:"short"});s[l]=(s[l]||0)+1}),Object.entries(s).map(([t,l])=>({day:t,count:l}))};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 to-white",children:[e.jsx(A,{userRole:"instructor"}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>u(`/instructor/study-materials/${i}`),className:"text-indigo-600 hover:text-indigo-800 mb-2 flex items-center",children:[e.jsx(C,{className:"h-4 w-4 mr-1"}),"Back to Study Materials"]}),e.jsx("h1",{className:"text-3xl font-bold text-indigo-900",children:"RAG Analytics"}),e.jsxs("p",{className:"text-indigo-600",children:["For class: ",j.name]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{className:"text-indigo-600 bg-indigo-50 hover:bg-indigo-100 px-4 py-2 rounded-md transition duration-300 font-medium flex items-center",children:[e.jsx(k,{className:"mr-2 h-5 w-5"}),"Export Data"]}),e.jsxs(L,{to:`/instructor/study-materials/${i}`,className:"bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition duration-300 font-medium flex items-center",children:[e.jsx(m,{className:"mr-2 h-5 w-5"}),"Manage Materials"]})]})]}),o&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 text-red-600 rounded-md flex items-center",children:[e.jsx(F,{className:"h-5 w-5 mr-2"}),o]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-indigo-100 p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"p-3 bg-indigo-100 rounded-lg mr-4",children:e.jsx(q,{className:"h-6 w-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-indigo-900",children:"Indexed Materials"}),e.jsx("p",{className:"text-3xl font-bold text-indigo-600",children:"7"})]})]}),e.jsx("div",{className:"h-1 w-full bg-indigo-100 rounded-full",children:e.jsx("div",{className:"h-1 bg-indigo-600 rounded-full",style:{width:"70%"}})}),e.jsx("p",{className:"text-xs text-indigo-500 mt-1",children:"7 of 10 materials indexed"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-indigo-100 p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"p-3 bg-teal-100 rounded-lg mr-4",children:e.jsx(E,{className:"h-6 w-6 text-teal-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-indigo-900",children:"Total Queries"}),e.jsx("p",{className:"text-3xl font-bold text-teal-600",children:r.length})]})]}),e.jsx("div",{className:"h-1 w-full bg-teal-100 rounded-full",children:e.jsx("div",{className:"h-1 bg-teal-600 rounded-full",style:{width:"60%"}})}),e.jsx("p",{className:"text-xs text-teal-500 mt-1",children:"Last 7 days"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-indigo-100 p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg mr-4",children:e.jsx(I,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-indigo-900",children:"Active Users"}),e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:"12"})]})]}),e.jsx("div",{className:"h-1 w-full bg-purple-100 rounded-full",children:e.jsx("div",{className:"h-1 bg-purple-600 rounded-full",style:{width:"80%"}})}),e.jsx("p",{className:"text-xs text-purple-500 mt-1",children:"Out of 15 enrolled students"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-indigo-100 p-6 mb-8",children:[e.jsxs("h2",{className:"text-xl font-semibold text-indigo-900 mb-6 flex items-center",children:[e.jsx(R,{className:"h-5 w-5 mr-2 text-indigo-600"}),"Queries by Day"]}),e.jsx("div",{className:"h-64 flex items-end justify-between space-x-2",children:v().map(s=>e.jsxs("div",{className:"flex-1 flex flex-col items-center",children:[e.jsx("div",{className:"relative w-full",children:e.jsx("div",{className:"bg-indigo-600 hover:bg-indigo-700 rounded-t transition-all duration-200 w-full",style:{height:`${s.count/35*100}%`}})}),e.jsx("div",{className:"text-xs text-indigo-600 mt-2",children:s.day})]},s.day))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-indigo-100 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-indigo-100 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-indigo-900",children:"Recent Student Queries"}),e.jsxs("div",{className:"relative w-64",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-indigo-400 h-4 w-4"}),e.jsx("input",{type:"text",value:d,onChange:s=>f(s.target.value),placeholder:"Search queries...",className:"w-full pl-9 pr-4 py-2 border border-indigo-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white"})]})]}),p?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):x.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(m,{className:"h-12 w-12 text-indigo-300 mx-auto mb-3"}),e.jsx("h3",{className:"text-xl font-semibold text-indigo-900 mb-2",children:"No queries found"}),e.jsx("p",{className:"text-indigo-600",children:"Students haven't asked any questions yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-indigo-100",children:[e.jsx("thead",{className:"bg-indigo-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-indigo-500 uppercase tracking-wider",children:"Query"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-indigo-500 uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-indigo-500 uppercase tracking-wider",children:"Date & Time"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-indigo-100",children:x.map(s=>e.jsxs("tr",{className:"hover:bg-indigo-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("p",{className:"text-indigo-800",children:s.question})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-indigo-600",children:s.userId.replace("user-","Student ")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-indigo-600",children:new Date(s.timestamp).toLocaleString()})]},s.id))})]})})]})]})]})};export{K as default};
