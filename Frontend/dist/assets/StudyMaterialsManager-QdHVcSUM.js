import{c as $,e as z,u as B,a as G,r,j as e,A as H,L as V,g as Z,D as J,T as K}from"./index-CGocrW-2.js";import{s as l}from"./supabaseClient-XQ6Slhkl.js";import{D as O}from"./DashboardHeader-B5PeDfLb.js";import{C as Q}from"./chart-no-axes-column-increasing-Bfv4dTGp.js";import{U as W}from"./upload-B1Fa68AH.js";import{C as S}from"./circle-alert-OdMR_p__.js";import{C}from"./circle-check-big-Dq-9WIkn.js";import"./index-DAE5hqnr.js";import"./x-CKoSI4A3.js";import"./users-D5Ca1YqY.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],F=$("File",X),xe=()=>{const{classId:d}=z(),{currentUser:Y}=B(),_=G(),[u,o]=r.useState([]),[k,p]=r.useState(!0),[m,ee]=r.useState(0),[M,f]=r.useState(!1),[g,n]=r.useState(null),[w,h]=r.useState(null),[I,L]=r.useState({id:d,name:"Loading class details..."}),[c,U]=r.useState(""),[y,j]=r.useState({});r.useEffect(()=>{D(),A()},[d]);const A=async()=>{try{const{data:s,error:t}=await l.from("classes").select("*").eq("id",d).single();if(t)throw t;L(s)}catch(s){console.error("Failed to fetch class details:",s),n("Failed to load class details. Please try again.")}},D=async()=>{try{p(!0);const{data:s,error:t}=await l.from("study_materials").select("*").eq("class_id",d).order("upload_date",{ascending:!1});if(t)throw t;o(s)}catch(s){console.error("Failed to fetch study materials:",s),n("Failed to load study materials. Please try again.")}finally{p(!1)}},P=async s=>{const t=s.target.files;if(t.length)try{f(!0),n(null);for(let a=0;a<t.length;a++){const i=t[a],x=`${d}/${i.name}`,{error:b}=await l.storage.from("study-materials").upload(x,i);if(b)throw b;const{data:q,error:v}=await l.from("study_materials").insert([{class_id:d,file_name:i.name,file_path:x,file_size:i.size,file_type:i.type,upload_date:new Date,indexed:!1}]);if(v)throw v;o(T=>[...T,...q])}h("Materials uploaded successfully!")}catch(a){console.error("Failed to upload materials:",a),n("Failed to upload materials. Please try again.")}finally{f(!1)}},E=async s=>{if(window.confirm(`Are you sure you want to delete ${s.file_name}?`))try{const{error:t}=await l.storage.from("study-materials").remove([s.file_path]);if(t)throw t;const{error:a}=await l.from("study_materials").delete().eq("id",s.id);if(a)throw a;o(i=>i.filter(x=>x.id!==s.id)),h("Material deleted successfully!")}catch(t){console.error("Failed to delete material:",t),n("Failed to delete material. Please try again.")}},R=async s=>{try{j(a=>({...a,[s.id]:!0})),await new Promise(a=>setTimeout(a,2e3));const{error:t}=await l.from("study_materials").update({indexed:!0}).eq("id",s.id);if(t)throw t;o(a=>a.map(i=>i.id===s.id?{...i,indexed:!0}:i)),h(`${s.file_name} indexed successfully for RAG!`)}catch(t){console.error("Failed to index document:",t),n("Failed to index document. Please try again.")}finally{j(t=>({...t,[s.id]:!1}))}},N=c?u.filter(s=>{var t;return s.file_name.toLowerCase().includes(c.toLowerCase())||((t=s.description)==null?void 0:t.toLowerCase().includes(c.toLowerCase()))}):u;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 to-white",children:[e.jsx(O,{userRole:"instructor"}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>_("/instructor"),className:"text-indigo-600 hover:text-indigo-800 mb-2 flex items-center",children:[e.jsx(H,{className:"h-4 w-4 mr-1"}),"Back to Dashboard"]}),e.jsx("h1",{className:"text-3xl font-bold text-indigo-900",children:"Study Materials Manager"}),e.jsxs("p",{className:"text-indigo-600",children:["For class: ",I.name]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(V,{to:`/instructor/rag-analytics/${d}`,className:"text-indigo-600 bg-indigo-50 hover:bg-indigo-100 px-4 py-2 rounded-md transition duration-300 font-medium flex items-center",children:[e.jsx(Q,{className:"mr-2 h-5 w-5"}),"View Analytics"]}),e.jsxs("label",{className:"bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition duration-300 font-medium flex items-center cursor-pointer",children:[e.jsx(W,{className:"mr-2 h-5 w-5"}),"Upload Materials",e.jsx("input",{type:"file",multiple:!0,onChange:P,className:"hidden",accept:".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.txt",disabled:M})]})]})]}),m>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"w-full bg-indigo-100 rounded-full h-2.5",children:e.jsx("div",{className:"bg-indigo-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${m}%`}})}),e.jsx("p",{className:"text-sm text-indigo-600 mt-1",children:m<100?"Uploading...":"Upload complete!"})]}),g&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 text-red-600 rounded-md flex items-center",children:[e.jsx(S,{className:"h-5 w-5 mr-2"}),g]}),w&&e.jsxs("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 text-green-600 rounded-md flex items-center",children:[e.jsx(C,{className:"h-5 w-5 mr-2"}),w]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-indigo-400 h-5 w-5"}),e.jsx("input",{type:"text",placeholder:"Search study materials...",value:c,onChange:s=>U(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-indigo-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white placeholder-indigo-300"})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-indigo-100 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-indigo-100 bg-indigo-50",children:e.jsx("h2",{className:"text-xl font-semibold text-indigo-900",children:"Study Materials"})}),k?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):N.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(F,{className:"h-12 w-12 text-indigo-300 mx-auto mb-3"}),e.jsx("h3",{className:"text-xl font-semibold text-indigo-900 mb-2",children:"No study materials yet"}),e.jsx("p",{className:"text-indigo-600 mb-4",children:"Upload study materials to make them available to students"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-indigo-100",children:[e.jsx("thead",{className:"bg-indigo-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-indigo-500 uppercase tracking-wider",children:"File"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-indigo-500 uppercase tracking-wider",children:"Size"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-indigo-500 uppercase tracking-wider",children:"Uploaded"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-indigo-500 uppercase tracking-wider",children:"RAG Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-indigo-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-indigo-100",children:N.map(s=>e.jsxs("tr",{className:"hover:bg-indigo-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(F,{className:"h-5 w-5 text-indigo-500 mr-3"}),e.jsxs("div",{children:[e.jsx("a",{href:s.downloadURL,target:"_blank",rel:"noopener noreferrer",className:"text-indigo-600 hover:text-indigo-900 font-medium",children:s.fileName}),e.jsx("p",{className:"text-xs text-indigo-500",children:s.fileType})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-indigo-600",children:[(s.fileSize/1024/1024).toFixed(2)," MB"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-indigo-600",children:new Date(s.uploadDate.seconds*1e3).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.indexed?e.jsxs("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full flex items-center w-fit",children:[e.jsx(C,{className:"h-3 w-3 mr-1"}),"Indexed"]}):e.jsxs("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-700 text-xs rounded-full flex items-center w-fit",children:[e.jsx(S,{className:"h-3 w-3 mr-1"}),"Not Indexed"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[!s.indexed&&e.jsx("button",{onClick:()=>R(s),disabled:y[s.id],className:"text-indigo-600 hover:text-indigo-900 disabled:opacity-50 flex items-center",children:y[s.id]?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-b-2 border-indigo-600 rounded-full mr-1"}),"Indexing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),"Index for RAG"]})}),e.jsxs("button",{onClick:()=>E(s),className:"text-red-600 hover:text-red-900 flex items-center",children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),"Delete"]})]})})]},s.id))})]})})]})]})]})};export{xe as default};
